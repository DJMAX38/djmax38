<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>DJ MAX ‚Äì Club & Boutique</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        :root {
            --bg: #050509;
            --bg-soft: #0b0b12;
            --card: #10101a;
            --border: #26263a;
            --text: #f9fafb;
            --muted: #9ca3af;

            --red: #ff2b4f;
            --red-soft: #ff5c7a;
            --pink: #ff7fbf;      /* rose pastel lumineux */
            --accent: #5b5bff;

            --radius: 14px;
            --shadow: 0 18px 45px rgba(0, 0, 0, 0.8);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        button {
            font-family: inherit;
        }

        /* FOND N√âONS ROUGE + ROSE */
        .neon-bg {
            position: fixed;
            inset: 0;
            z-index: -2;
            background: radial-gradient(circle at top, #1b1024 0, #050509 55%);
            overflow: hidden;
        }

        .neon-line {
            position: absolute;
            width: 220%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--red), var(--pink), transparent);
            opacity: 0.25;
            filter: blur(2px);
            animation: moveNeon 14s linear infinite;
        }

        .neon-line:nth-child(1) { top: 18%; animation-duration: 16s; }
        .neon-line:nth-child(2) { top: 34%; animation-duration: 12s; }
        .neon-line:nth-child(3) { top: 52%; animation-duration: 18s; }
        .neon-line:nth-child(4) { top: 70%; animation-duration: 14s; }
        .neon-line:nth-child(5) { top: 86%; animation-duration: 20s; }

        @keyframes moveNeon {
            from { transform: translateX(-50%); }
            to   { transform: translateX(50%); }
        }

        /* NAVBAR */
        nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 70px;
            background: rgba(5,5,10,0.9);
            backdrop-filter: blur(18px);
            border-bottom: 1px solid #1f1f2b;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 26px;
            z-index: 1000;
        }

        .nav-left {
            font-weight: 800;
            font-size: 18px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--pink);
        }

        .nav-links {
            display: flex;
            gap: 12px;
            font-size: 14px;
        }

        .nav-links button {
            padding: 6px 10px;
            border-radius: 999px;
            border: none;
            background: transparent;
            color: var(--muted);
            font-weight: 500;
            cursor: pointer;
            transition: 0.18s;
        }

        .nav-links button:hover {
            color: var(--pink);
            background: rgba(255, 127, 191, 0.12);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(255, 127, 191, 0.18);
            color: #ffe4f3;
        }

        .icon-btn {
            border-radius: 999px;
            border: 1px solid #2b2b3f;
            background: #0b0b12;
            color: var(--muted);
            padding: 6px 10px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: 0.18s;
        }

        .icon-btn.small {
            padding: 4px 8px;
            font-size: 12px;
        }

        .icon-btn:hover {
            border-color: var(--pink);
            color: var(--pink);
            box-shadow: 0 0 12px rgba(255, 127, 191, 0.4);
        }

        main {
            padding-top: 70px;
        }

        /* NOTIF */
        .notif {
            position: fixed;
            top: 72px;
            left: 50%;
            transform: translateX(-50%);
            background: #111827;
            color: var(--text);
            padding: 8px 14px;
            border-radius: 999px;
            font-size: 13px;
            border: 1px solid #374151;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            display: none;
            z-index: 1200;
        }

        /* PAGES (ONE-PAGE APP) */
        .page {
            display: none;
            min-height: calc(100vh - 70px);
        }

        .page.active {
            display: block;
        }

        .section {
            padding: 60px 18px;
            max-width: 1120px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 6px;
            color: #fef2f7;
            text-shadow: 0 0 18px rgba(255, 127, 191, 0.6);
        }

        .section-sub {
            font-size: 14px;
            color: var(--muted);
            margin-bottom: 24px;
        }

        /* HERO ACCUEIL */
        .hero {
            min-height: calc(100vh - 70px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 18px 60px;
        }

        .hero-inner {
            max-width: 900px;
            text-align: center;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(91, 91, 255, 0.18);
            color: #e5e7ff;
            margin-bottom: 14px;
        }

        .hero-title {
            font-size: clamp(32px, 5vw, 46px);
            font-weight: 800;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            margin-bottom: 10px;
            text-shadow:
                0 0 22px rgba(255, 43, 79, 0.8),
                0 0 32px rgba(255, 127, 191, 0.7);
        }

        .hero-sub {
            font-size: 15px;
            color: var(--muted);
            max-width: 520px;
            margin: 0 auto 22px;
        }

        .hero-actions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn {
            display: inline-block;
            padding: 9px 18px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid var(--pink);
            background: transparent;
            color: var(--pink);
            transition: 0.2s;
        }

        .btn:hover {
            background: var(--pink);
            color: #050509;
            box-shadow: 0 0 18px rgba(255, 127, 191, 0.7);
        }

        .btn-ghost {
            border-color: #3b3b4f;
            color: var(--muted);
        }

        .btn-ghost:hover {
            border-color: var(--accent);
            color: #e5e7ff;
            background: rgba(91, 91, 255, 0.18);
        }

        /* CARDS */
        .card {
            background: radial-gradient(circle at top left, rgba(255,127,191,0.12), transparent 55%), #090910;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .card-inner {
            position: relative;
            z-index: 1;
        }

        /* AUDIO */
        .audio-block {
            margin-top: 10px;
            padding: 12px;
            border-radius: 12px;
            background: #151520;
            box-shadow: 0 0 12px rgba(91, 91, 255, 0.4);
        }

        audio { width: 100%; margin-top: 6px; }

        /* BOUTIQUE GRID */
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 18px;
        }

        .product-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .product-price {
            font-size: 14px;
            color: var(--pink);
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* PANIER SLIDE-IN */
        .cart-panel {
            position: fixed;
            top: 70px;
            right: 0;
            width: 320px;
            max-width: 90%;
            height: calc(100vh - 70px);
            background: #050509;
            border-left: 1px solid #1f2933;
            box-shadow: -10px 0 30px rgba(0,0,0,0.8);
            transform: translateX(100%);
            transition: transform 0.25s ease-out;
            z-index: 1100;
            display: flex;
            flex-direction: column;
        }

        .cart-panel.open {
            transform: translateX(0);
        }

        .cart-header {
            padding: 14px 14px 10px;
            border-bottom: 1px solid #1f2933;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .cart-body {
            flex: 1;
            padding: 12px 14px;
            overflow-y: auto;
            font-size: 13px;
            color: var(--muted);
        }

        .cart-footer {
            padding: 12px 14px 16px;
            border-top: 1px solid #1f2933;
            font-size: 13px;
        }

        .cart-item {
            margin-bottom: 8px;
        }

        /* MODAL COMPTE */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.75);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1200;
        }

        .modal {
            background: #0b0b12;
            border-radius: 18px;
            border: 1px solid #2f2f44;
            box-shadow: 0 24px 60px rgba(0,0,0,0.9);
            width: 90%;
            max-width: 420px;
            padding: 22px 20px 18px;
            position: relative;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .modal-sub {
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 16px;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 12px;
            border: none;
            background: transparent;
            color: var(--muted);
            cursor: pointer;
            font-size: 18px;
        }

        .field {
            margin-bottom: 12px;
        }

        .field label {
            display: block;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .field input {
            width: 100%;
            padding: 8px 10px;
            border-radius: 999px;
            border: 1px solid #2f2f44;
            background: #05050b;
            color: var(--text);
            font-size: 13px;
        }

        .field input:focus {
            outline: none;
            border-color: var(--pink);
            box-shadow: 0 0 0 1px rgba(255, 127, 191, 0.4);
        }

        .modal-footer {
            margin-top: 12px;
            font-size: 12px;
            color: var(--muted);
        }

        .modal-footer button {
            border: none;
            background: transparent;
            color: var(--pink);
            cursor: pointer;
            padding: 0;
            font-size: 12px;
        }

        footer {
            padding: 22px 20px;
            text-align: center;
            font-size: 12px;
            color: var(--muted);
            border-top: 1px solid #1f1f2b;
            background: #050509;
        }

        @media (max-width: 700px) {
            nav { padding: 0 14px; }
            .nav-links { display: none; }
        }
    </style>
</head>

<body>

<div class="neon-bg">
    <div class="neon-line"></div>
    <div class="neon-line"></div>
    <div class="neon-line"></div>
    <div class="neon-line"></div>
    <div class="neon-line"></div>
</div>

<nav>
    <div class="nav-left">DJ MAX CLUB</div>

    <div class="nav-links">
        <button onclick="openPage('home')">Accueil</button>
        <button onclick="openPage('events')">√âv√®nements</button>
        <button onclick="openPage('creations')">Cr√©ations DJ</button>
        <button onclick="openPage('shop')">Boutique</button>
        <button onclick="openPage('legal')">Mentions l√©gales</button>
    </div>

    <div class="nav-actions">
        <div id="loyalty-pill" class="pill" style="display:none;">
            ‚ù§Ô∏è <span id="loyalty-points">0</span> pts
        </div>
        <button class="icon-btn" id="cart-btn">üõí <span id="cart-count">0</span></button>
        <button class="icon-btn" id="account-btn">üë§ <span id="account-label">Compte</span></button>
    </div>
</nav>

<div class="notif" id="notif"></div>

<div class="cart-panel" id="cart-panel">
    <div class="cart-header">
        <span>Panier</span>
        <button class="icon-btn small" id="cart-close">Fermer</button>
    </div>
    <div class="cart-body" id="cart-items">Aucun article pour le moment.</div>
    <div class="cart-footer">
        Total : <span id="cart-total">0,00 ‚Ç¨</span><br>
        <button class="btn" style="margin-top:8px;" onclick="checkout()">Valider ma r√©servation</button>
    </div>
</div>

<main>

<section class="page active" id="page-home">
    <div class="hero">
        <div class="hero-inner">
            <div class="hero-badge">Ambiance club ‚Ä¢ Boutique ‚Ä¢ Fid√©lit√©</div>
            <div class="hero-title">ENTRE DANS LE CLUB DJ MAX</div>
            <div class="hero-sub">
                Accueil anim√©e, n√©ons rouges & rose pastel, √©v√®nements, cr√©ations, boutique, compte client et fid√©lit√© g√©olocalis√©e.
            </div>
            <div class="hero-actions">
                <button class="btn" onclick="openPage('events')">Voir les √©v√®nements</button>
                <button class="btn btn-ghost" onclick="openAccount()">Cr√©er / g√©rer mon compte</button>
            </div>
        </div>
    </div>
</section>

<section class="page" id="page-events">
    <div class="section">
        <div class="section-title">√âv√®nements</div>
        <div class="section-sub">
            Valide ta pr√©sence (moins de 1 km du lieu) et gagne 10 points de fid√©lit√©. Compte obligatoire.
        </div>

        <div class="card">
            <div class="card-inner">
                <h3>DJ MAX au Restaurant Le Local</h3>
                <p>üìç Rue Fernand Forest, 38120 Saint-√âgr√®ve</p>
                <p>üìÖ 26 f√©vrier 2026 ‚Ä¢ üïí 19h ‚Äì 22h</p>
                <button class="btn" onclick="validatePresence('event-26')">
                    Valider ma pr√©sence (+10 pts)
                </button>
            </div>
        </div>

        <div class="card" style="margin-top:18px;">
            <div class="card-inner">
                <h3>Jeu du DJ anim√© par DJ MAX</h3>
                <p>üìç Rue Luce Douady, 38450 Noyarey</p>
                <p>üìÖ 28 f√©vrier 2026 ‚Ä¢ üïí 21h ‚Äì 22h</p>
                <button class="btn" onclick="validatePresence('event-28')">
                    Valider ma pr√©sence (+10 pts)
                </button>
            </div>
        </div>
    </div>
</section>

<section class="page" id="page-creations">
    <div class="section">
        <div class="section-title">Cr√©ations du DJ</div>
        <div class="section-sub">Titres officiels DJ MAX.</div>

        <div class="card">
            <div class="card-inner">
                <h3>I‚Äôm Still Standing ‚Äì DJ MAX</h3>
                <div class="audio-block">
                    <audio controls>
                        <source src="Im Still Standing.mp3" type="audio/mpeg">
                    </audio>
                </div>

                <h3 style="margin-top:25px;">Ph√©nom√©nal ‚Äì DJ MAX</h3>
                <div class="audio-block">
                    <audio controls>
                        <source src="Ph√©nom√©nal.mp3" type="audio/mpeg">
                    </audio>
                </div>

                <h3 style="margin-top:25px;">Ne m'arr√™te pas maintenant ‚Äì DJ MAX</h3>
                <div class="audio-block">
                    <audio controls>
                        <source src="Ne m'arr√™te pas maintenant.mp3" type="audio/mpeg">
                    </audio>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="page" id="page-shop">
    <div class="section">
        <div class="section-title">Boutique officielle</div>
        <div class="section-sub">Ajoute au panier et r√©serve tes articles.</div>

        <div class="products">
            <div class="card">
                <div class="card-inner">
                    <div class="product-title">Chaussettes DJ MAX ‚Äì Logo 2026</div>
                    <div class="product-price">4,50 ‚Ç¨</div>
                    <button class="btn" onclick="addToCart('Chaussettes DJ MAX ‚Äì Logo 2026', 4.5)">Ajouter au panier</button>
                </div>
            </div>

            <div class="card">
                <div class="card-inner">
                    <div class="product-title">Veste zipp√©e DJ MAX ‚Äì Logo blanc</div>
                    <div class="product-price">13,00 ‚Ç¨</div>
                    <button class="btn" onclick="addToCart('Veste zipp√©e DJ MAX ‚Äì Logo blanc', 13)">Ajouter au panier</button>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="page" id="page-legal">
    <div class="section">
        <div class="section-title">Mentions l√©gales</div>
        <div class="section-sub">Informations officielles.</div>

        <div class="card">
            <div class="card-inner">
                <p><strong>√âditeur :</strong> DJ MAX ‚Äì Noyarey</p>
                <p><strong>Contact :</strong> maxens.gv@djmax38.com</p>
                <p><strong>H√©bergement :</strong> GitHub Pages</p>
                <p><strong>Donn√©es personnelles :</strong> Stock√©es localement sur l‚Äôappareil (compte, fid√©lit√©, panier).</p>
            </div>
        </div>
    </div>
</section>

</main>

<footer>
    ¬© 2026 ‚Äì DJ MAX ‚Ä¢ Tous droits r√©serv√©s
</footer>

<div class="modal-backdrop" id="account-modal">
    <div class="modal">
        <button class="modal-close" onclick="closeAccountModal()">√ó</button>
        <div id="account-modal-content"></div>
    </div>
</div>

<script>
    const LS_USER = "djmax_user";
    const LS_LOYALTY = "djmax_loyalty";
    const LS_EVENTS = "djmax_events_validated";
    const LS_CART = "djmax_cart";

    let currentUser = null;
    let loyaltyPoints = 0;
    let validatedEvents = {};
    let cart = [];

    const pages = {
        home: document.getElementById("page-home"),
        events: document.getElementById("page-events"),
        creations: document.getElementById("page-creations"),
        shop: document.getElementById("page-shop"),
        legal: document.getElementById("page-legal")
    };

    const accountLabel = document.getElementById("account-label");
    const loyaltyPill = document.getElementById("loyalty-pill");
    const loyaltySpan = document.getElementById("loyalty-points");
    const cartCount = document.getElementById("cart-count");
    const cartItems = document.getElementById("cart-items");
    const cartTotal = document.getElementById("cart-total");
    const cartPanel = document.getElementById("cart-panel");
    const notif = document.getElementById("notif");

    const accountModal = document.getElementById("account-modal");
    const accountModalContent = document.getElementById("account-modal-content");

    function showNotif(msg) {
        notif.textContent = msg;
        notif.style.display = "block";
        setTimeout(() => { notif.style.display = "none"; }, 2500);
    }

    function openPage(name) {
        Object.values(pages).forEach(p => p.classList.remove("active"));
        if (pages[name]) pages[name].classList.add("active");
        window.scrollTo({ top: 0, behavior: "instant" });
    }

    function loadState() {
        try {
            const u = localStorage.getItem(LS_USER);
            if (u) currentUser = JSON.parse(u);

            const l = localStorage.getItem(LS_LOYALTY);
            if (l) loyaltyPoints = parseInt(l, 10) || 0;

            const e = localStorage.getItem(LS_EVENTS);
            if (e) validatedEvents = JSON.parse(e);

            const c = localStorage.getItem(LS_CART);
            if (c) cart = JSON.parse(c);
        } catch (err) {
            currentUser = null;
            loyaltyPoints = 0;
            validatedEvents = {};
            cart = [];
        }
        updateUI();
    }

    function saveUser() {
        if (currentUser) localStorage.setItem(LS_USER, JSON.stringify(currentUser));
        else localStorage.removeItem(LS_USER);
        updateUI();
    }

    function saveLoyalty() {
        localStorage.setItem(LS_LOYALTY, String(loyaltyPoints));
        updateUI();
    }

    function saveEvents() {
        localStorage.setItem(LS_EVENTS, JSON.stringify(validatedEvents));
    }

    function saveCart() {
        localStorage.setItem(LS_CART, JSON.stringify(cart));
        updateUI();
    }

    function updateUI() {
        if (currentUser) {
            accountLabel.textContent = currentUser.name || currentUser.id || "Mon compte";
            loyaltyPill.style.display = "inline-flex";
        } else {
            accountLabel.textContent = "Compte";
            loyaltyPill.style.display = "none";
        }

        loyaltySpan.textContent = loyaltyPoints;

        cartCount.textContent = cart.length;

        if (cart.length === 0) {
            cartItems.textContent = "Aucun article pour le moment.";
            cartTotal.textContent = "0,00 ‚Ç¨";
        } else {
            cartItems.innerHTML = "";
            let total = 0;
            cart.forEach(item => {
                const line = document.createElement("div");
                line.className = "cart-item";
                line.textContent = item.name + " ‚Äì " + item.price.toFixed(2) + " ‚Ç¨";
                cartItems.appendChild(line);
                total += item.price;
            });
            cartTotal.textContent = total.toFixed(2) + " ‚Ç¨";
        }
    }

    function openAccount(mode) {
        if (!mode) {
            mode = currentUser ? "profile" : "login";
        }
        if (mode === "login") {
            accountModalContent.innerHTML = `
                <div class="modal-title">Connexion</div>
                <div class="modal-sub">Connecte-toi avec ton identifiant et ton mot de passe (enregistr√©s sur cet appareil).</div>
                <div class="field">
                    <label>Identifiant</label>
                    <input type="text" id="login-id" placeholder="Ton identifiant">
                </div>
                <div class="field">
                    <label>Mot de passe</label>
                    <input type="password" id="login-pass" placeholder="Ton mot de passe">
                </div>
                <button class="btn" style="margin-top:8px;" onclick="doLogin()">Se connecter</button>
                <div class="modal-footer">
                    Pas encore de compte ?
                    <button onclick="openAccount('register')">Cr√©er un compte</button>
                </div>
            `;
        } else if (mode === "register") {
            accountModalContent.innerHTML = `
                <div class="modal-title">Cr√©ation de compte</div>
                <div class="modal-sub">Compte enregistr√© sur cet appareil, pour le panier et la fid√©lit√©.</div>
                <div class="field">
                    <label>Nom / Pseudo</label>
                    <input type="text" id="reg-name" placeholder="DJ MAX Fan">
                </div>
                <div class="field">
                    <label>Adresse e‚Äëmail</label>
                    <input type="email" id="reg-mail" placeholder="ton.email@example.com">
                </div>
                <div class="field">
                    <label>Identifiant</label>
                    <input type="text" id="reg-id" placeholder="Choisis ton identifiant">
                </div>
                <div class="field">
                    <label>Mot de passe</label>
                    <input type="password" id="reg-pass" placeholder="Choisis ton mot de passe">
                </div>
                <button class="btn" style="margin-top:8px;" onclick="doRegister()">Cr√©er mon compte</button>
                <div class="modal-footer">
                    Tu as d√©j√† un compte ?
                    <button onclick="openAccount('login')">Se connecter</button>
                </div>
            `;
        } else if (mode === "profile" && currentUser) {
            accountModalContent.innerHTML = `
                <div class="modal-title">Mon compte</div>
                <div class="modal-sub">Connect√© en tant que <strong>${currentUser.name || currentUser.id}</strong>.</div>
                <p style="font-size:13px; color:var(--muted); margin-bottom:8px;">
                    Identifiant : <strong>${currentUser.id}</strong><br>
                    E‚Äëmail : <strong>${currentUser.email || "non renseign√©"}</strong><br>
                    Points fid√©lit√© : <strong>${loyaltyPoints}</strong>
                </p>
                <button class="btn btn-ghost" onclick="logout()">Se d√©connecter</button>
            `;
        }
        accountModal.style.display = "flex";
    }

    function closeAccountModal() {
        accountModal.style.display = "none";
    }

    function doRegister() {
        const name = document.getElementById("reg-name").value.trim();
        const email = document.getElementById("reg-mail").value.trim();
        const id = document.getElementById("reg-id").value.trim();
        const pass = document.getElementById("reg-pass").value.trim();

        if (!name || !email || !id || !pass) {
            showNotif("Merci de remplir tous les champs.");
            return;
        }

        currentUser = { name, email, id, pass };
        loyaltyPoints = 0;
        validatedEvents = {};
        saveUser();
        saveLoyalty();
        saveEvents();
        closeAccountModal();
        showNotif("Compte cr√©√© et connect√©.");
    }

    function doLogin() {
        const id = document.getElementById("login-id").value.trim();
        const pass = document.getElementById("login-pass").value.trim();

        if (!id || !pass) {
            showNotif("Merci de remplir identifiant et mot de passe.");
            return;
        }

        const u = localStorage.getItem(LS_USER);
        if (!u) {
            showNotif("Aucun compte enregistr√© sur cet appareil.");
            return;
        }
        const stored = JSON.parse(u);
        if (stored.id === id && stored.pass === pass) {
            currentUser = stored;
            loyaltyPoints = parseInt(localStorage.getItem(LS_LOYALTY) || "0", 10);
            validatedEvents = JSON.parse(localStorage.getItem(LS_EVENTS) || "{}");
            updateUI();
            closeAccountModal();
            showNotif("Connexion r√©ussie.");
        } else {
            showNotif("Identifiant ou mot de passe incorrect.");
        }
    }

    function logout() {
        currentUser = null;
        saveUser();
        closeAccountModal();
        showNotif("D√©connect√©.");
    }

    // Haversine pour distance en km
    function distanceKm(lat1, lon1, lat2, lon2) {
        const R = 6371;
        const toRad = d => d * Math.PI / 180;
        const dLat = toRad(lat2 - lat1);
        const dLon = toRad(lon2 - lon1);
        const a =
            Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
    }

    // Coordonn√©es approximatives
    const EVENT_COORDS = {
        "event-26": { lat: 45.214, lon: 5.69 },  // Rue Fernand Forest, Saint-√âgr√®ve
        "event-28": { lat: 45.23,  lon: 5.65 }   // Rue Luce Douady, Noyarey
    };

    function validatePresence(eventId) {
        if (!currentUser) {
            showNotif("Compte obligatoire pour valider ta pr√©sence.");
            openAccount("login");
            return;
        }
        if (validatedEvents[eventId]) {
            showNotif("Pr√©sence d√©j√† valid√©e pour cet √©v√®nement.");
            return;
        }

        if (!navigator.geolocation) {
            showNotif("G√©olocalisation non disponible sur cet appareil.");
            return;
        }

        navigator.geolocation.getCurrentPosition(
            pos => {
                const userLat = pos.coords.latitude;
                const userLon = pos.coords.longitude;
                const target = EVENT_COORDS[eventId];
                if (!target) {
                    showNotif("Erreur de configuration de l‚Äô√©v√®nement.");
                    return;
                }
                const d = distanceKm(userLat, userLon, target.lat, target.lon);
                if (d <= 1) {
                    validatedEvents[eventId] = true;
                    loyaltyPoints += 10;
                    saveEvents();
                    saveLoyalty();
                    showNotif("Pr√©sence valid√©e : +10 points de fid√©lit√©.");
                } else {
                    showNotif("Tu es trop loin du lieu (distance > 1 km).");
                }
            },
            err => {
                showNotif("G√©olocalisation refus√©e ou indisponible.");
            }
        );
    }

    function addToCart(name, price) {
        cart.push({ name, price });
        saveCart();
        showNotif("Article ajout√© au panier.");
    }

    function checkout() {
        if (!currentUser) {
            showNotif("Tu dois √™tre connect√© pour valider ta r√©servation.");
            openAccount("login");
            return;
        }
        if (cart.length === 0) {
            showNotif("Ton panier est vide.");
            return;
        }
        showNotif("R√©servation enregistr√©e. Contacte maxens.gv@djmax38.com avec ton identifiant.");
    }

    document.getElementById("cart-btn").addEventListener("click", () => {
        cartPanel.classList.add("open");
    });

    document.getElementById("cart-close").addEventListener("click", () => {
        cartPanel.classList.remove("open");
    });

    document.getElementById("account-btn").addEventListener("click", () => {
        openAccount();
    });

    window.addEventListener("click", (e) => {
        if (e.target === accountModal) closeAccountModal();
    });

    loadState();
</script>

</body>
</html>
